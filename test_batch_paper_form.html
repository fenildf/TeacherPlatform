<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>批量导入试卷---课程运营平台</title>
	<link rel="stylesheet" type="text/css" href="http://css03.xesimg.com/xes_test_edit.css" />
	<script type="text/javascript" src="http://js03.xesimg.com/xes.base.js"></script>
	<script type="text/javascript" src="http://js03.xesimg.com/xes.js"></script>

</head>

<body>
	<h1 class="ui_infor_title">
		<span>导入试卷</span>
	</h1>

	<ul class="labelCon">
		<li>
			<label for=""><em class="red">※ </em>试卷名称</label>
			<span>
				<input size="" value="" type="text" class="input_text" id="testpaperName"/>
			</span>
		</li>
		<li>
			<label for=""><em class="red">※ </em>试卷类型</label>
			<span>
				<select id="paper_type" class="ui-select-list" id="testpaperType">
					<option class="ui-select-button" value="1">测试卷</option>
					<option value="2">考卷</option>

				</select>
			</span>
			<div class="paper_type_box">
				<label for=""><em class="red">※</em>答题时间</label>
				<span>
					<input size="" value="" type="text" class="input_text" id="answerTime"/>
				</span>
				<label for=""><em class="red">※</em>试卷分值</label>
				<span>
					<input type="radio" value="1" name="testpaperScore" checked="true">
					100
					<input type="radio" value="1" name="testpaperScore">
					120
					<input type="radio" value="1" name="testpaperScore">
					150
					<input type="radio" value="1" name="testpaperScore">
					300
				</span>
			</div>
		</li>
		<li>
			
		</li>
		<li>
			<label for=""><em class="red">※ </em>选择学部</label>
			<span>
				<select class="ui-select-list" id="departmentId" name="departmentId">
					<option class="ui-select-button" value="0">年级</option>
					<option value="1">小学</option>
					<option value="2">初中</option>
					<option value="3">高中</option>

				</select>
			</span>
		</li>

		<li>
			<label for=""><em class="red">※ </em>所属学科</label>
			<span>
												<input type="radio" value="1" name="subjectId" id="subjectId" >语文									<input type="radio" value="2" name="subjectId" id="subjectId" >数学									<input type="radio" value="3" name="subjectId" id="subjectId" >英语									<input type="radio" value="4" name="subjectId" id="subjectId" >物理									<input type="radio" value="5" name="subjectId" id="subjectId" >化学									<input type="radio" value="6" name="subjectId" id="subjectId" >生物									<input type="radio" value="12" name="subjectId" id="subjectId" >综合									<input type="radio" value="14" name="subjectId" id="subjectId" >理综									<input type="radio" value="18" name="subjectId" id="subjectId" >全科									<input type="radio" value="19" name="subjectId" id="subjectId" >讲座													</span>
		</li>
		<li class="infor">
			<label for="">试卷描述</label>
			<span>
				<textarea class="paper_text" id="testpaperDescription"></textarea>
			</span>

		</li>
		<li class="question_handle">
			<p class="question_handle_btn items_collapsed">收起</p>
			<p class="question_counts">共导入3道试题，3个解析（带<em class="red">※</em>为必填项）</p>
		</li>
		<li class="question_items">
						<dl class="question_item test_paper" id="question_item_0">
				<dt class="item_head">
					<span class="btn_accordion">+</span>
					<span class="item_number">1</span>
				</dt>
				<dd class="item_btn">
					<a class="item_delete" href="javascript:void(0);">删除</a>
				</dd>
				<dd class="item_body">
					<div class="item_body_1st">
						<span class="item_num"><label for="" class="first"><em class="red">※ </em>试题序号</label> <input type="text" class="input_text w30" id="serialNumber_0" value="1"/> </span>
						<span class="item_sorce"><label for=""><em class="red">※ </em>分值</label><input type="text" class="input_text w30" id="questionScore_0" value="0"/></span>
						<span class="item_title"><label for=""> 试题名称</label><input type="text" class="input_text w200" id="testName_0" value=""/></span>
					</div>
					<div class="item_pic">
						<label for="" class="first"><em class="red">※ </em>试题题干</label>
						<a href="###" id="testContent_0">
							<em class="imgView">http://x01.xesimg.com/test_papers/2013/05/21/13691027271340.jpg</em></a>
						<label for=""> 解析</label>
						<a href="###" id="testContent_0">
							<em class="imgView">http://x01.xesimg.com/test_papers/2013/05/21/13691027271340.jpg</em></a>
					</div>
					<div>
						<label for="" class="first"><span class="red">※ </span>知 识 点</label>
						<span id="knowledge" class="knowledge_box"></span>
						<span class="knowledge_setall">
							<input type="button" value="应用所有" class="btn_brown" />
						</span>
					</div>
					<div>
						<label for="" class="first"><span class="red">※ </span>试题类型</label>
						<span><input type="radio" checked="true" name="testType_0"  size="" value="1" class="questions_type_button">选择题</span>
						<span><input type="radio" name="testType_0" size="" value="2" class="questions_type_button">填空题</span>
					</div>
					<div class="questions_type_box">
						<label for="" class="first"><span class="red">※ </span>正确答案</label>
						<span style="display: block;" class="questions_type" id="questions_type_checkbox_0">
							<input type="checkbox" name="correctAnswer[]" value="1">
							A
							<input type="checkbox" name="correctAnswer[]" value="2">
							B
							<input type="checkbox" name="correctAnswer[]" value="4">
							C
							<input type="checkbox" name="correctAnswer[]" value="8">
							D
						</span>
						<p class="questions_type" style="display: none;" id="questions_type_input_0">
							<span>
								<input type="text" class="input_text" name="fillCorrectAnswer[]" value="">
								<a onclick="addFillCorrectAnswer(this);" href="###">追加</a>
							</span>
						</p>
					</div>
					<div>
						<label for="" class="first">关 键 字</label><input type="text" class="input_text w130" id="keyword_0" value=""/>
						<label for="">自定义难度系数</label><input type="text" class="input_text w80" id="customDifficulty_0" value="0.1"/>
						<label for="">关联解析视频ID</label><input type="text" class="input_text w100" placeholder="" id="analysisVideo_0" value=""/><input type="button" value="选择" class="btn_brown" onclick="sectionLists(0);"/>
					</div>
				</dd>
			</dl>
						<dl class="question_item test_paper" id="question_item_1">
				<dt class="item_head">
					<span class="btn_accordion">+</span>
					<span class="item_number">2</span>
				</dt>
				<dd class="item_btn">
					<a class="item_delete" href="javascript:void(0);">删除</a>
				</dd>
				<dd class="item_body">
					<div class="item_body_1st">
						<span class="item_num"><label for="" class="first"><em class="red">※ </em>试题序号</label> <input type="text" class="input_text w30" id="serialNumber_1" value="2"/> </span>
						<span class="item_sorce"><label for=""><em class="red">※ </em>分值</label><input type="text" class="input_text w30" id="questionScore_1" value="0"/></span>
						<span class="item_title"><label for=""> 试题名称</label><input type="text" class="input_text w200" id="testName_1" value=""/></span>
					</div>
					<div class="item_pic">
						<label for="" class="first"><em class="red">※ </em>试题题干</label>
						<a href="###" id="testContent_1">
							<em class="imgView">http://s02.xesimg.com/test_papers/2013/05/21/13691027271340.jpg</em></a>
						<label for=""> 解析</label>
						<a href="###" id="testContent_1">
							<em class="imgView">http://r04.xesimg.com/test_papers/2013/05/21/13691027271340.jpg</em></a>
					</div>
					<div>
						<label for="" class="first"><span class="red">※ </span>知 识 点</label>
						<span id="knowledge" class="knowledge_box"></span>
						<span class="knowledge_setall">
							<input type="button" value="应用所有" class="btn_brown" />
						</span>
					</div>
					<div>
						<label for="" class="first"><span class="red">※ </span>试题类型</label>
						<span><input type="radio" checked="true" name="testType_1"  size="" value="1" class="questions_type_button">选择题</span>
						<span><input type="radio" name="testType_1" size="" value="2" class="questions_type_button">填空题</span>
					</div>
					<div class="questions_type_box">
						<label for="" class="first"><span class="red">※ </span>正确答案</label>
						<span style="display: block;" class="questions_type" id="questions_type_checkbox_1">
							<input type="checkbox" name="correctAnswer[]" value="1">
							A
							<input type="checkbox" name="correctAnswer[]" value="2">
							B
							<input type="checkbox" name="correctAnswer[]" value="4">
							C
							<input type="checkbox" name="correctAnswer[]" value="8">
							D
						</span>
						<p class="questions_type" style="display: none;" id="questions_type_input_1">
							<span>
								<input type="text" class="input_text" name="fillCorrectAnswer[]" value="">
								<a onclick="addFillCorrectAnswer(this);" href="###">追加</a>
							</span>
						</p>
					</div>
					<div>
						<label for="" class="first">关 键 字</label><input type="text" class="input_text w130" id="keyword_1" value=""/>
						<label for="">自定义难度系数</label><input type="text" class="input_text w80" id="customDifficulty_1" value="0.1"/>
						<label for="">关联解析视频ID</label><input type="text" class="input_text w100" placeholder="" id="analysisVideo_1" value=""/><input type="button" value="选择" class="btn_brown" onclick="sectionLists(1);"/>
					</div>
				</dd>
			</dl>
						<dl class="question_item test_paper" id="question_item_2">
				<dt class="item_head">
					<span class="btn_accordion">+</span>
					<span class="item_number">3</span>
				</dt>
				<dd class="item_btn">
					<a class="item_delete" href="javascript:void(0);">删除</a>
				</dd>
				<dd class="item_body">
					<div class="item_body_1st">
						<span class="item_num"><label for="" class="first"><em class="red">※ </em>试题序号</label> <input type="text" class="input_text w30" id="serialNumber_2" value="3"/> </span>
						<span class="item_sorce"><label for=""><em class="red">※ </em>分值</label><input type="text" class="input_text w30" id="questionScore_2" value="0"/></span>
						<span class="item_title"><label for=""> 试题名称</label><input type="text" class="input_text w200" id="testName_2" value=""/></span>
					</div>
					<div class="item_pic">
						<label for="" class="first"><em class="red">※ </em>试题题干</label>
						<a href="###" id="testContent_2">
							<em class="imgView">http://s01.xesimg.com/test_papers/2013/05/21/13691027271340.jpg</em></a>
						<label for=""> 解析</label>
						<a href="###" id="testContent_2">
							<em class="imgView">http://s04.xesimg.com/test_papers/2013/05/21/13691027271340.jpg</em></a>
					</div>
					<div>
						<label for="" class="first"><span class="red">※ </span>知 识 点</label>
						<span id="knowledge" class="knowledge_box"></span>
						<span class="knowledge_setall">
							<input type="button" value="应用所有" class="btn_brown" />
						</span>
					</div>
					<div>
						<label for="" class="first"><span class="red">※ </span>试题类型</label>
						<span><input type="radio" checked="true" name="testType_2"  size="" value="1" class="questions_type_button">选择题</span>
						<span><input type="radio" name="testType_2" size="" value="2" class="questions_type_button">填空题</span>
					</div>
					<div class="questions_type_box">
						<label for="" class="first"><span class="red">※ </span>正确答案</label>
						<span style="display: block;" class="questions_type" id="questions_type_checkbox_2">
							<input type="checkbox" name="correctAnswer[]" value="1">
							A
							<input type="checkbox" name="correctAnswer[]" value="2">
							B
							<input type="checkbox" name="correctAnswer[]" value="4">
							C
							<input type="checkbox" name="correctAnswer[]" value="8">
							D
						</span>
						<p class="questions_type" style="display: none;" id="questions_type_input_2">
							<span>
								<input type="text" class="input_text" name="fillCorrectAnswer[]" value="">
								<a onclick="addFillCorrectAnswer(this);" href="###">追加</a>
							</span>
						</p>
					</div>
					<div>
						<label for="" class="first">关 键 字</label><input type="text" class="input_text w130" id="keyword_2" value=""/>
						<label for="">自定义难度系数</label><input type="text" class="input_text w80" id="customDifficulty_2" value="0.1"/>
						<label for="">关联解析视频ID</label><input type="text" class="input_text w100" placeholder="" id="analysisVideo_2" value=""/><input type="button" value="选择" class="btn_brown" onclick="sectionLists(2);"/>
					</div>
				</dd>
			</dl>
					</li>

		<li>
			<label for="">&nbsp;</label>
  			<span>
				<input type="hidden" value="http://s03.xesimg.com/batch_test/2013/06/14/13711876408068.pdf" id="filePath">
				<a href="###" class="btn btn_submit" onclick="addQuestions()">保存</a>
			</span>
		</li>
</ul>
<script type="text/javascript" src="http://js03.xesimg.com/import/import.test.batch.js"></script>

</body>
<script type="text/javascript">

		function addQuestions(){
			var params = '';
			
			//试题文件路径
			var filePath = $('#filePath').val();
			if(filePath == ''){
				alert('试题文件不合法');
				return false;
			}
			params +='filePath='+filePath;
			
			//试卷名称
			var testpaperName = $('#testpaperName').val();
			if(testpaperName == ''){
				alert('试卷名称不能为空');
				$('#testpaperName').addClass('error');
				return false;
			}else{
				$('#testpaperName').removeClass('error');
			}
			params +='&testpaperName='+testpaperName;
		
			//试卷类型
			var testpaperType = $('#paper_type').val();
			if(testpaperType != 1 && testpaperType != 2){
				alert('试卷类型不合法');
				return false;
			}
			params +='&testpaperType='+testpaperType;	
			
			//如果试卷为考试卷
			if(testpaperType == 2){
				//答题时间
				var answerTime = $('#answerTime').val();
				if(answerTime == ''){
					alert('答题时间不能为空');
					return false;
				}
				params +='&answerTime='+answerTime;
			
				//试卷分值
				var testpaperScore = $("input[name='testpaperScore']:checked").val()
				if(testpaperScore == undefined){
					alert('试卷分值不能为空');
					return false;
				}	
				params +='&testpaperScore='+testpaperScore;
			}

			//学科
			var subjectId = $("input[name='subjectId']:checked").val()
			if(checkRate(subjectId) == false){
				alert('学科id不合法');
				return false;
			}
		
			//学部
			var departmentId = $('#departmentId').val();
			if(departmentId != 1 && departmentId !=2 && departmentId != 3){
				alert('学部不合法');
				return false;	
			}
			params +='&departmentId='+departmentId;
		
			//试题描述
			var testpaperDescription = $('#testpaperDescription').val();
			if(testpaperDescription != ''){
				params +='&testpaperDescription='+testpaperDescription;
			}
		
			//批量试题处理
			var questions = batchTest.getValue();
			// console.log(questions);
			// return false;
			if(!questions){
				return false;
			}
			params +='&questions='+questions;
			var url = "/testPapers/batchAddPaper/";
			$.ajax({
				url :url,
				type:'post',
				dataType:'json',
				data:params,
				success: function (data) {
					if(data.sign == 0){
						alert(data.msg);
					}else{
						alert('添加试卷成功');
						//返回列表页
						goTab('/testPapers/paperLists/', '试卷列表', 'menu_7_7_2', 'batch_add_paper');
					}
				},
				error: function() {
					alert('数据读取错误..');
				}
			});	
			
		}		
		
		//选择解析视频
		function sectionLists(num){
			var result = window.showModalDialog('/testQuestions/teacherSectionLists/','','dialogLeft:300px;dialogTop:360px;dialogWidth:930px;DialogHeight=430px;status:no;resizable:1;')
			$('#analysisVideo'+'_'+num).attr('value',result);
		}	
		
		function checkRate(value){ 
			var re = /^[1-9]+[0-9]*]*$/;
			if (!re.test(value)){   
				return false;   
			}   
		}  	
	</script>		
</html>

		
