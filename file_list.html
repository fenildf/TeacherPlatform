<!DOCTYPE html>
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> -->
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>文件列表---课程运营平台</title>
		<link rel="stylesheet" type="text/css" href="http://css03.xesimg.com/xes_file.css"/>
		<script type="text/javascript" src="http://js03.xesimg.com/xes.base.js"></script>
		<script type="text/javascript" src="http://js03.xesimg.com/xes.js"></script>

	</head>

	<body>

		<h1 class="ui_infor_title">
			<span>文件共享</span>
		</h1>
		<form action="/teacherCourses/shareFileLists/" name="" id="listSerch" method="post">
			<div class="s_grade">
				<table >
					<tr>	
						<td align="left">
							<input value=""  class="input_text" type="text" name="keywords" placeholder="按关键字筛选"/>
							<input type="hidden" id="currpage" name="curpage" value="1" />
							<input class="s-btn" type="submit" value="筛选" ></td>
					</tr>
				</table>
			</div>
		</form>
		<div class="share_updown">
			<span>
				<a id="btn_fileUpload" href="###">上传</a>
			</span>
			<span>
				<a id="btn_fileDown" href="###">下载</a>
			</span>
			<span>
				<a id="menu_6_2" href="/teacherCourses/teacherShareLists/" class="open_tabs">我的分享</a>
			</span>
		</div>
		<div class="action_item share_item">
			<ul class="item_pag ui_pages">
									<li class="page_list ui-select-box"><span>共7条 &nbsp;</span><select  name="pages" id="pages" class="ui-select"><option selected>1/1</option></select></li><li class='page_btn'><span class='page_prev' >上一页</span></li><li class="page_btn"><span class="page_next">下一页</span></li>							</ul>
			<p class="action_side file_size"><span>0.26M</span>/500M</p>
		</div>
		<div class="contentData contentData1">
			<table class="grid_item" id="share_fiels_ids">
				<colgroup>
					<col width="50px" />
					<col width="" />
					<col width="80px" />
					<col width="200px" />
					<col width="60px" />
				</colgroup>
				<thead>
					<tr>
						<th>选择</th>
						<th>文件名</th>
						<th>大小</th>
						<th>创建日期</th>
						<th>操作</th>
					</tr>
				</thead>
				<tbody id="fileList">
																		<tr>
								<td><input type="checkbox" name="file_box" class="file_checkbox" id="file_box_1" value="10"/></td>
								<td>
									<p class="textZip">短信接口.txt</p>
								</td>
								<td>
																																				1K
																											</td>
								<td>2013-02-26 12:45:03</td>
								<td>
									<a id="student_111" onclick="fileShare(10,'http://x02.xesimg.com/sharefile/guyunzeng/201302/13618539035822.txt')" class="" title="查看" href="###" text="徐倩1">分享</a>
								</td>
							</tr>
													<tr>
								<td><input type="checkbox" name="file_box" class="file_checkbox" id="file_box_1" value="9"/></td>
								<td>
									<p class="textZip">QQ截图20121130094238.jpg</p>
								</td>
								<td>
																														38K
																											</td>
								<td>2013-02-26 11:32:29</td>
								<td>
									<a id="student_111" onclick="fileShare(9,'http://x02.xesimg.com/sharefile/guyunzeng/201302/13618495497763.jpg')" class="" title="查看" href="###" text="徐倩1">分享</a>
								</td>
							</tr>
													<tr>
								<td><input type="checkbox" name="file_box" class="file_checkbox" id="file_box_1" value="8"/></td>
								<td>
									<p class="textZip">QQ截图20121130093946.jpg</p>
								</td>
								<td>
																														94K
																											</td>
								<td>2013-02-26 10:48:46</td>
								<td>
									<a id="student_111" onclick="fileShare(8,'http://x01.xesimg.com/sharefile/guyunzeng/201302/13618469268410.jpg')" class="" title="查看" href="###" text="徐倩1">分享</a>
								</td>
							</tr>
													<tr>
								<td><input type="checkbox" name="file_box" class="file_checkbox" id="file_box_1" value="7"/></td>
								<td>
									<p class="textZip">QQ截图20121130093934.jpg</p>
								</td>
								<td>
																														93K
																											</td>
								<td>2013-02-26 10:41:52</td>
								<td>
									<a id="student_111" onclick="fileShare(7,'http://s03.xesimg.com/sharefile/guyunzeng/201302/13618465125230.jpg')" class="" title="查看" href="###" text="徐倩1">分享</a>
								</td>
							</tr>
													<tr>
								<td><input type="checkbox" name="file_box" class="file_checkbox" id="file_box_1" value="6"/></td>
								<td>
									<p class="textZip">QQ截图20121130093445.jpg</p>
								</td>
								<td>
																														17K
																											</td>
								<td>2013-02-26 10:17:14</td>
								<td>
									<a id="student_111" onclick="fileShare(6,'http://x02.xesimg.com/sharefile/guyunzeng/201302/13618450344939.jpg')" class="" title="查看" href="###" text="徐倩1">分享</a>
								</td>
							</tr>
													<tr>
								<td><input type="checkbox" name="file_box" class="file_checkbox" id="file_box_1" value="2"/></td>
								<td>
									<p class="textZip">运维上线制度.xls</p>
								</td>
								<td>
																														22K
																											</td>
								<td>2013-02-25 17:45:43</td>
								<td>
									<a id="student_111" onclick="fileShare(2,'http://s03.xesimg.com/sharefile/guyunzeng/201302/13617855437388.xls')" class="" title="查看" href="###" text="徐倩1">分享</a>
								</td>
							</tr>
													<tr>
								<td><input type="checkbox" name="file_box" class="file_checkbox" id="file_box_1" value="1"/></td>
								<td>
									<p class="textZip">测试.docx</p>
								</td>
								<td>
																														2K
																											</td>
								<td>2013-02-25 15:01:54</td>
								<td>
									<a id="student_111" onclick="fileShare(1,'http://x04.xesimg.com/sharefile/guyunzeng/201302/13617757141704.docx')" class="" title="查看" href="###" text="徐倩1">分享</a>
								</td>
							</tr>
															</tbody>
			</table>
		</div>

		<div class="action_item">
			<ul class="item_pag ui_pages">
									<li class='page_btn'><span class='page_prev' >上一页</span></li><li class="page_btn"><span class="page_next">下一页</span></li>							</ul>
		</div>
		<!-- 学员列表-->
		<!-- 弹出框 分享 -->
		<div id="win_fileShare" class="share_layer xes_win">
			<h1>
				<span>分享文件</span>
				<span class="close">关闭</span>
			</h1>
			<form action="" class="contenttxt">

				<p class="textinfor">资源下载链接：<span class="filepath">http://teacher.com/updown/12345.zip</span></p>
				<p class="cla_input">
				班级ID：
					<input value=""  id="shareCourseIds" name="shareCourseIds" class="input_text" type="text"/>
				</p>
				<p class="area_input">
					<label>内容：</label>
					<textarea id="shareContext" name="shareContext"></textarea>
				</p>
				<input type="hidden" name="shareId" id="shareId" value="" class="fileid" />
				<p class="sharebutton">
					<a href="#" class="btnshare" id="btnshare">分享</a>
					<a href="#" class="btncannel">取消</a>
				</p>
			</form>
		</div>
		<!-- 弹出框 分享 End-->
		<!-- 弹出框 上传 -->
		<form action="/teacherCourses/uploadShareFile/" name="" id="listSerch" method="POST" enctype="multipart/form-data" onsubmit="return checkUpload();">
			<div id="win_fileUpload" class="share_layer xes_win w300">
				<h1>
					<span>分享文件</span>
					<span class="close">关闭</span>
				</h1>
				<div class="contenttxt">
					<p class="textinfor">上传文件大小不能超过5M</p>
					<p class="file_input">
				文件：<input  type="file"  name="test_context" id="test_context"/>
					</p>
					<p class="sharebutton">
						<button class="btnshare" type="submit">上传</button>
					</p>
				</div>
			</div>
		</form>
		<!-- 弹出框 分享 End-->
		<script type="text/javascript" src="http://js03.xesimg.com/import/import.file.list.js"></script>
		<script type="text/javascript">
		/**
		 * 根据数组里面的值，设置选中的checkbox
		 */
		// function setChecked(id){
		// 	// 复选框
 	// 		var _checkbox = $('table[id='+id+'] tr input[type="checkbox"]');
 	// 		// 获取已有的cookie值
 	// 		var _cookieval = $.cookie(id);
 	// 		// 将cookie值转化为数组；
 	// 		var _values = _cookieval ? _cookieval.split(',') : [];
 	// 		// 去除数组中的空白项（原来方法里面里面开头的“，”）
 	// 		_values = $.grep(_values, function(n) {return $.trim(n).length > 0;})

		// 	_checkbox.each(function(){
		// 		var index = $.inArray($(this).val(), _values);
		// 		if(index >= 0){
		// 			$(this).attr('checked',true);
		// 		}
		// 	});
		// }

		/**
		 * 清除已选项
		 * @return {[type]}
		 */
		// function emptyChecked(id, val){
		// 	var _val = $.cookie(id);
		// 	_val = _val ? _val.split(',') : [];
 	// 		var _checkbox = $('table[id='+id+'] tr input[type="checkbox"]');
 	// 		_checkbox.each(function(){
 	// 			var _v = $(this).val();
 	// 			if( $.inArray(_v , _val) > -1){
 	// 				this.checked = false;
 	// 			}
 	// 		});
		// 	$.cookie(id, null);

		//     // var date = new Date();
		//     // date.setTime(date.getTime() - 10000);
		//     // document.cookie = id + "=a; expires=" + date.toGMTString()+"; path=/";
		// }
		/**
		 * 根据点击checkbox设置cookie值
		 * 
		 */
		// function setCheckedValue(cookiename,box){
 	// 		// 获取已有的cookie值
 	// 		var _cookieval = $.cookie(cookiename);
 	// 		// 将cookie值转化为数组；
 	// 		var _values = _cookieval ? _cookieval.split(',') : [];
 	// 		// 去除数组中的空白项（原来方法里面里面开头的“，”）
 	// 		_values = $.grep(_values, function(n) {return $.trim(n).length > 0;})

		// 	var __checked = $(box).attr('checked');

		// 	var __val = $(box).val();

		// 	var __index = $.inArray(__val, _values);

		// 	/**
		// 	 * 如果选中，且cookie中不存在，则添加
		// 	 * 如果取消选中，且cookie里存在，则删除
		// 	 */
		// 	if( (__checked == 'checked') && (__index == -1) ){

		// 		_values.push(__val);

		// 	}else if( (__checked != 'checked') && (__index >= 0)){

		// 		_values.splice(__index,1);

		// 	}

		// 	$.cookie(cookiename, _values);

		// }
 
	//cookie
	$(function() {
		xes.form.checkboxClick('share_fiels_ids', 'file_box');
		// // 获取已有的cookie值
		// var cookieVal = $.cookie('share_fiels_ids');
		// if(cookieVal && cookieVal != ''){
		// 	//根据cookie值设置已选项
		// 	xes.form.setCheckBox('file_box', cookieVal);
		// }
		// // var _checkbox = $('#'+id).find('input[type="checkbox"]');
		
 	// 	$('#share_fiels_ids').find('input:checkbox').click(function(){
 	// 		xes.form.setCheckedValue('share_fiels_ids', this);
 	// 	});
	});			
	
	//下载文件
	function fileDown(){
		var shareIds = xes.form.getCheckedValue('file_box');
		if(shareIds.length>0){
			// shareIds = shareIds.replace(/^,/,'').replace(/,$/,'');

			// var url = 'http://teacher-b.wss-test2.0.com/teacherCourses/downloadShareFile/'+shareIds;
			// $.cookie('share_fiels_ids',null);
			// $('#share_fiels_ids tr input:checkbox').each(function(){
			// 	$(this).attr('checked',false);
			// });	
			console.clear();
			console.log(shareIds);		
			
			xes.form.emptyChecked('share_fiels_ids');
			// window.location.href = url;
			// 
		}else{
			alert('请选择要下载的文件');
		}
	}	
	
	//上传文件
	function checkUpload(){
		var upload = $('#test_context').val();
		if(upload == ''){
			alert('上传文件不能为空');
			return false;
		}
		return true;
	}
	
	//老师分享文件
	$('#btnshare').click(function(){
		var shareCourseIds = $('#shareCourseIds').val();
		if(shareCourseIds == ''){
			alert('分享课程不能为空');
			return false;
		}
		var shareContext = $('#shareContext').val();
		if(shareContext == ''){
			alert('分享内容不能为空');
			return false;
		}
		var shareId = $('#shareId').val();
		if(shareId == ''){
			alert('文件id不合法');
			return false;
		}
		var params = 'shareId='+shareId+'&shareCourseIds='+shareCourseIds+'&shareContext='+shareContext;
		var url = "http://teacher-b.wss-test2.0.com/teacherCourses/teacherShareFile/";
		$.ajax({
			url :url,
			type:'post',
			dataType:'json',
			data:params,
			success: function (data) {
				if(data.sign == 0){
					alert(data.msg);
				}else{
					alert('分享成功');
					$('#shareCourseIds').val('');
					$('#shareContext').val('');
					xes.dialog.hide();
					goTab('http://teacher-b.wss-test2.0.com/teacherCourses/teacherShareLists/', '我的分享', 'menu_6_2',false);
				}
			},
			error: function() {
				alert('数据读取错误..');
			}
		});			
	});
		</script>
	</body>
</html>